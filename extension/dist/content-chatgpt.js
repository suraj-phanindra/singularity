import{P as m}from"./chunks/platform-config-CdiS7NYx.js";const d="ChatGPT",a=m["chat.openai.com"];console.log("[Singularity] Content script loaded for ChatGPT");let i=!0,c=0;chrome.storage.local.get(["enabled"],r=>{i=r.enabled!==!1});chrome.runtime.onMessage.addListener((r,t,e)=>{r.action==="toggleExtension"&&(i=r.enabled),e({success:!0})});function f(){new MutationObserver(t=>{if(!i)return;const e=document.querySelectorAll(a.messageContainerSelector);e.length>c&&(b(e),c=e.length)}).observe(document.body,{childList:!0,subtree:!0}),console.log("[Singularity] Started observing ChatGPT conversation")}async function b(r){const t=Array.from(r).slice(c);for(const e of t){const s=e.getAttribute("data-message-author-role"),o=e.innerText||e.textContent;if(o&&o.trim().length>0){const n={platform:d,text:o.trim(),isUser:s==="user",timestamp:new Date().toISOString(),url:window.location.href};try{await chrome.runtime.sendMessage({action:"extractContext",message:n}),console.log("[Singularity] Sent message for extraction:",n)}catch(l){console.error("[Singularity] Failed to send message:",l)}}}}function h(){new MutationObserver(()=>{const t=document.querySelector(a.inputSelector),e=document.querySelector(a.submitButtonSelector);t&&e&&!e.dataset.singularityHooked&&(e.dataset.singularityHooked="true",e.addEventListener("click",async s=>{if(!i)return;const o=t.value||t.textContent;if(!(!o||o.trim().length===0)){console.log("[Singularity] User is sending:",o);try{const n=await chrome.runtime.sendMessage({action:"getRelevantContext",message:o,platform:d});if(n&&n.context&&n.context.length>0){console.log("[Singularity] Injecting context:",n.context),s.preventDefault(),s.stopPropagation();const u=`[Context from other AI conversations: ${n.context.join("; ")}]

`+o;t.tagName==="TEXTAREA"?t.value=u:t.textContent=u,t.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>{e.click()},100)}}catch(n){console.error("[Singularity] Failed to inject context:",n)}}},{capture:!0,once:!0}))}).observe(document.body,{childList:!0,subtree:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",g):g();function g(){console.log("[Singularity] Initializing for ChatGPT"),f(),h()}
